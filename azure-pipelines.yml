# https://aka.ms/yaml

jobs:
- job: 'Build_macOS'
  pool:
    vmImage: 'macos-10.13'
  steps:
  - script: git submodule update --init --recursive
    displayName: 'Checkout Submodules'
  - script: ./osx-install-tools.sh
    displayName: 'Install Tools'
  - script: ./build-package-deps-osx.sh
    displayName: 'Build And Package'

  - task: PublishBuildArtifacts@1
    condition: ne(variables['Build.Reason'], 'PullRequest')
    inputs:
      pathtoPublish: './osx'
      artifactName: osx-deps

- job: 'Build_Win64'
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - script: ./win-install-tools.sh
    displayName: 'Install Tools'  
  - script: ./win64.sh
    displayName: 'Build deps'
  
  - task: PublishBuildArtifacts@1
    condition: ne(variables['Build.Reason'], 'PullRequest')
    inputs:
      pathtoPublish: './FFmpeg-n4.1.4/ffbuild'
      artifactName: ffmpeglogs

  - task: PublishBuildArtifacts@1
    condition: ne(variables['Build.Reason'], 'PullRequest')
    inputs:
      pathtoPublish: './buildprefix'
      artifactName: win64-deps

